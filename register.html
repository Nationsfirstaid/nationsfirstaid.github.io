<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Register – Nations First Aid</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="style.css" />
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-auth-compat.js"></script>
</head>
<body>
  <div class="center">
    <img class="watermark" src="logos/RedPNG_76c2cae5-c477-4636-b41a-881bb9e091a5.png" alt="Red Watermark" />
    <img class="logo" src="logos/White_PNG_74dcf535-3999-4f0a-b1fa-bbcebd79a35c.png" alt="Nations First Aid Logo" />
    <div class="site-name">NATIONS FIRST AID</div>

    <div class="nav-btns">
      <a href="index.html">Home</a>
      <a href="about.html">About</a>
      <a href="courses.html">Courses</a>
      <a href="register.html">Register</a>
      <a href="contact.html">Contact</a>
    </div>

    <main style="max-width: 500px; margin: 0 auto; background: rgba(255,255,255,0.04); border-radius: 12px; padding: 28px 16px 20px 16px;">
      <h2 style="color:#fff; text-align:center; margin-bottom: 16px;">Register for a Class</h2>

      <!-- Email Link Login Section -->
      <div id="email-auth-section">
        <label for="auth-email">Enter your Email Address</label><br>
        <input type="email" id="auth-email" style="width:100%;padding:8px;" required><br><br>
        <button id="send-link-btn" type="button" style="width:100%;padding:10px;">Send Sign-In Link</button>
        <p id="email-message" style="color:#fff; margin-top:10px;"></p>
      </div>

      <!-- Hidden full form after verification -->
      <form id="regForm" action="https://formsubmit.co/nationsfirstaid@mail.com" method="POST" style="display:none;">
        <input type="hidden" name="_captcha" value="false">

        <label for="name">Full Name</label><br>
        <input type="text" id="name" name="name" required style="width:100%;padding:8px;"><br><br>

        <label for="phone">Phone Number</label><br>
        <input type="tel" id="phone" name="phone" required style="width:100%;padding:8px;"><br><br>

        <label for="course">Course Interested In</label><br>
        <select id="course" name="course" required style="width:100%;padding:8px;">
          <option value="">-- Select a course --</option>
          <option value="Standard First Aid (SFA) with CPR/AED Level C – 2 day">Standard First Aid (SFA) – 2 day</option>
          <option value="Standard First Aid (SFA) with CPR/AED Level C – Blended">SFA – Blended</option>
          <option value="Standard First Aid (SFA) with CPR/AED Level C – RECERTIFICATION">SFA – Recert</option>
          <option value="Emergency First Aid (EFA) with CPR/AED Level C">Emergency First Aid</option>
          <option value="Marine Basic First Aid (MBFA)">Marine Basic First Aid</option>
          <option value="CPR/AED Level C">CPR/AED Level C</option>
        </select><br><br>

        <label for="start-date">Preferred Start Date</label><br>
        <input type="date" id="start-date" name="start-date" required style="width:100%;padding:8px;"><br><br>

        <label for="end-date">Desired Certification By</label><br>
        <input type="date" id="end-date" name="end-date" required style="width:100%;padding:8px;"><br><br>

        <label for="message">Message</label><br>
        <textarea id="message" name="message" rows="3" style="width:100%;padding:8px;"></textarea><br><br>

        <button type="submit" class="cta" style="width:100%;padding:12px 0;font-size:1.1rem;">Submit Registration</button>
      </form>

      <div id="success-msg" style="color:lightgreen; display:none; margin-top: 20px; text-align:center;"></div>
    </main>
  </div>

  <footer>
    <div class="disclaimer">
      &copy; 2025 Nations First Aid. All rights reserved.<br>
      All images, logos, and illustrations on this site are the exclusive property of Nations First Aid and its creator.
    </div>
  </footer>

  <script>
    // Firebase Config
    const firebaseConfig = {
      apiKey: "AIzaSyCH2Leufmxtgtgay3nFr4zAysKTjBeZvUE",
      authDomain: "nationsfirstaid-19c03.firebaseapp.com",
      projectId: "nationsfirstaid-19c03",
      storageBucket: "nationsfirstaid-19c03.appspot.com",
      messagingSenderId: "YOUR_SENDER_ID",
      appId: "YOUR_APP_ID"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();

    // Action link URL (your GitHub page)
    const actionCodeSettings = {
      url: "https://nationsfirstaid.github.io/register.html",
      handleCodeInApp: true
    };

    // Send Sign-In Email
    document.getElementById("send-link-btn").addEventListener("click", () => {
      const email = document.getElementById("auth-email").value;
      if (!email) return alert("Please enter your email first.");
      auth.sendSignInLinkToEmail(email, actionCodeSettings)
        .then(() => {
          window.localStorage.setItem("emailForSignIn", email);
          document.getElementById("email-message").innerText = "Sign-in link sent! Check your inbox.";
        })
        .catch((error) => {
          document.getElementById("email-message").innerText = "Error: " + error.message;
        });
    });

    // Complete sign-in if coming from email link
    window.addEventListener("DOMContentLoaded", () => {
      if (auth.isSignInWithEmailLink(window.location.href)) {
        let email = window.localStorage.getItem("emailForSignIn");
        if (!email) {
          email = window.prompt("Please confirm your email to complete sign-in");
        }
        auth.signInWithEmailLink(email, window.location.href)
          .then(() => {
            document.getElementById("email-auth-section").style.display = "none";
            document.getElementById("regForm").style.display = "block";
            document.getElementById("success-msg").innerText = "✅ Email verified! Please complete your registration.";
            document.getElementById("success-msg").style.display = "block";
          })
          .catch((error) => {
            console.error("Error signing in with link", error);
          });
      }
    });

    // Date limit logic
    document.addEventListener("DOMContentLoaded", () => {
      const start = document.getElementById("start-date");
      const end = document.getElementById("end-date");
      const today = new Date();
      const plus60 = new Date();
      plus60.setDate(today.getDate() + 60);

      function fmt(d) {
        return d.toISOString().split('T')[0];
      }

      start.min = fmt(today);
      start.max = fmt(plus60);
      start.value = fmt(today);

      start.addEventListener("change", () => {
        const sd = new Date(start.value);
        const max = new Date(sd);
        max.setDate(sd.getDate() + 60);
        end.min = fmt(sd);
        end.max = fmt(max);
        end.value = fmt(max);
      });

      start.dispatchEvent(new Event('change'));
    });
  </script>
</body>
</html>
